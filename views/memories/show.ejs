<h1>Here is your memory!</h1>

<body>
    <div>
        <h2><%= place.name %></h2>
        <h3><%= place.city %></h3>
        <h3><%= place.state %></h3>
        <h3><%= place.country %></h3>
        <p><%= place.description %></p>
    </div>
    <button id="upload_widget" class="cloudinary-button">Upload A Picture</button>
    <div>
        <img class="responsive-img" alt="memory-image" id="memory-image" src="<%= place.imgUrl %>">
    </div> 

    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

    <script type="text/javascript">  
        let myWidget = cloudinary.createUploadWidget({
            cloudName: 'dschawel', 
            uploadPreset: 'et0rvort'}, (error, result) => { 
            if (!error && result && result.event === "success") { 
                console.log('Done! Here is the image info: ', result.info); 
                fetch('/memory', {
                    method: 'PUT',
                    body: JSON.stringify({ photoUrl: result.info.secure_url }),
                    headers: { "Content-Type": "application/json; charset=utf-8"}
                })
                .then((response) => response.json())
                .then((data) => {
                    console.log('success', data)
                    document.getElementById('memory-image').setAttribute('src', result.info.secure_url)
                })
                .catch((error) => {
                    console.log('error', error)
                })
                }
            }
        )
        
        document.getElementById("upload_widget").addEventListener("click", function(){
            myWidget.open();
        }, false);
    </script>
</body>